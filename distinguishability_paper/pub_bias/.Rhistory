}
prp_dc_list
prp_dc_list = c()
prp_d_list=c()
for (bb in seq(0,2,0.5)){
dd<-read.table(file=paste0("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/batch_eff/output/batch_2grp_bb_sd_",bb,".prp.out"))
ddc<-read.table(file=paste0("~/Desktop/rep_new/PRP/PRP_paper/batch_eff/output/batch_2grp_bb_sd_",bb,".prp.out"))
dd = data.frame(dd)
ddc = data.frame(ddc)
names(dd)<-c("V1", "rep_pval")
names(ddc)<-c("V1", "rep_pval")
prp_d_list<-c(prp_d_list,length(which(dd$rep_pval<0.05))/nrow(dd))
prp_dc_list<-c(prp_dc_list,length(which(ddc$rep_pval<0.05))/nrow(ddc))
}
prp_d_list
prp_dc_list
prp_dc_list = c()
prp_d_list=c()
for (bb in seq(0,2,0.5)){
dd<-read.table(file=paste0("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/batch_eff/output/batch_2grp_bb_sd_",bb,".prp.out"))
ddc<-read.table(file=paste0("~/Desktop/rep_new/PRP/PRP_paper/batch_eff/output/batch_2grp_bb_sd_",bb,".prp.out"))
dd = data.frame(dd)
ddc = data.frame(ddc)
names(dd)<-c("V1", "rep_pval")
names(ddc)<-c("V1", "rep_pval")
prp_d_list<-c(prp_d_list,length(which(dd$rep_pval<0.05))/nrow(dd))
prp_dc_list<-c(prp_dc_list,length(which(ddc$rep_pval<0.05))/nrow(ddc))
}
data_plot2<-data.frame(eta=seq(0,2,0.5),prior_prp_dc=prp_dc_list,
prior_prp_d=prp_d_list)
data_plot2_long <- melt(data_plot2,id="eta")
library(lattice)
data_plot2_long <- melt(data_plot2,id="eta")
library(lattice)
library(reshape2)
data_plot2_long <- melt(data_plot2,id="eta")
names(data_plot2_long)<-c("eta","type","sensitivity")
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c(expression(P[prior]~DC~Criterion),
expression(P[prior]~Distinguishability~Criterion)))+
scale_x_continuous(breaks = seq(0, 1, by = 0.2))
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c(expression(P[prior]~DC~Criterion),
expression(P[prior]~Distinguishability~Criterion)))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c(expression(P[prior]~DC),
expression(P[prior]~Distinguishability)))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =4)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =5)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =6)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =6)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
names(data_plot2_long)<-c("eta","criterion","sensitivity")
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =6)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=type))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =6)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=criterion))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =7)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=criterion))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =6.5)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=criterion))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =6.2)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=criterion))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
pdf(file="plots/sensitivity_batch_2grp_dc_vs_d.pdf",height=4.5, width =6.3)
ggplot(data=data_plot2_long,aes(x=eta,y=sensitivity,color=criterion))+
geom_line()+
geom_point()+
theme(legend.text.align = 0)+
theme_bw()+
xlab("batch effect magnitude")+
scale_color_discrete(labels=c("DC", "Distinguishability"))+
scale_x_continuous(breaks = seq(0, 2, by = 0.5))
dev.off()
setwd("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/RPP_analyze")
library(Rcpp)
library(RcppArmadillo)
library(RcppGSL)
library(ggplot2)
library(PRP)
data("RPP_filtered")
attach(RPP_filtered)
Rcpp::sourceCpp("PRP_MCMC_with_PI.cpp")
Rcpp::sourceCpp("PRP_MCMC_pubbias.cpp")
t= seq(0.001,0.05,0.001)
root_vec<-c(0)
for (t_ind in t){
f = function(k){
g = function(x){
(1/(1+exp(0.5*(1/k)^2+x/k)))*dnorm(x)}
return(integrate(g,-Inf,Inf)$value - t_ind)
}
root<-uniroot(f,c(1e-100,1e5),tol = .Machine$double.eps^0.2)$root
root_vec<-c(root_vec,root)
}
rpp_pval<-sapply(1:nrow(RPP_filtered),function(x)
PRP_MCMC_with_PI(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec)$pval)
## Distinguishability publication bias ts
rpp_pval_pubbias<-sapply(1:nrow(RPP_filtered),function(x)
PRP_MCMC(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec))
## Distingsuihability default vs publication bias ts
rpp_d=data.frame(test_statistics=rep(c("default","MCMC"),each=nrow(RPP_filtered)),rep_pval=c(rpp_pval,rpp_pval_pubbias))
pdf(file = paste0("rpp_pval_default_vs_pubbias.pdf"),width=6,height=5)
ggplot(rpp_d,aes(x=rep_pval))+
geom_histogram(aes(fill=test_statistics),color="white",bins=10,alpha=0.5,boundary=0,position = 'identity')+
scale_x_continuous(limits = c(0, 1))+
scale_fill_manual("test statistic",labels=c("default",expression(T[pb]==hat(beta)[rep]/hat(beta)[orig])),values=c("#69b3a2", "#404080"))+
xlab(expression(p["prior"]~Distinguishability~Criterion))+
theme_bw()
dev.off()
pval=c()
lo=c()
hi=c()
for (x in 1:nrow(RPP_filtered)){
res = PRP_MCMC_with_PI(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec)
pval = c(pval,res$pval)
lo = c(lo,res$left_bound)
hi = c(hi,res$right_bound)
}
data_new = data.frame(cbind("Study" =RPP_filtered[,1],"orig" =RPP_filtered[,2] ,
"rep"=RPP_filtered[,4] ,"pval"=pval,"PIlow" =lo,"PIhigh" =hi))
data_new[,1]<-as.factor(data_new[,1])
data<- data_new[order(data_new$pval,decreasing = T),]
data$Study2<- factor(data$Study,as.character(data$Study))
data$significance = as.factor((data$pval>0.05)+0)
pdf(file = paste0("rpp_PI_MCMC.pdf"),width=7,height=8.5)
ggplot(data)+
geom_pointrange(aes(x=Study2, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study2,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
scale_color_manual(" ",labels = c(expression(p[prior]~-~distinguishability< 0.05), expression(p[prior]~-~distinguishability> 0.05)), values = c("red", "blue")) +
coord_flip()+
ylim(-0.5,3.5)+
theme_bw()
dev.off()
Rcpp::sourceCpp("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/RPP_analyze/PRP_MCMC_with_PI.cpp")
load("~/Desktop/rep_new/RPP_filtered_with_n.RData")
PI<-function(betao,no,nr,lower=TRUE){
z975=1.96
int = sqrt(1/(no-3)+1/(nr-3))
if (lower){
pi.lo = betao-z975*int
return(pi.lo)
}
else{
pi.hi = betao+z975*int
return(pi.hi)
}
}
lo=c()
hi=c()
for (x in 1:nrow(data_with_n)){
lo = c(lo,PI(data_with_n$beta_orig[x],data_with_n$n.O[x],data_with_n$n.R[x]))
hi = c(hi,PI(data_with_n$beta_orig[x],data_with_n$n.O[x],data_with_n$n.R[x],lower=F))
}
data_jeff = data.frame(cbind("Study" =data_with_n[,1],"orig" =data_with_n[,2] ,
"rep"=RPP_filtered[,4] ,"PIlow" =lo,"PIhigh" =hi))
data_jeff[,1]<-as.factor(data_jeff[,1])
data_jeff$significance = as.factor(((data_jeff$rep>data_jeff$PIlow) & (data_jeff$rep<data_jeff$PIhigh))+0)
data_jeff
pval=c()
lo=c()
hi=c()
for (x in 1:nrow(RPP_filtered)){
res = PRP_MCMC_with_PI(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec)
pval = c(pval,res$pval)
lo = c(lo,res$left_bound)
hi = c(hi,res$right_bound)
}
data_D = data.frame(cbind("Study" =RPP_filtered[,1],"orig" =RPP_filtered[,2] ,
"rep"=RPP_filtered[,4] ,"pval"=pval,"PIlow" =lo,"PIhigh" =hi))
data_D
PI<-function(betao,no,nr,lower=TRUE){
z975=1.96
int = sqrt(1/(no-3)+1/(nr-3))
if (lower){
pi.lo = betao-z975*int
return(pi.lo)
}
else{
pi.hi = betao+z975*int
return(pi.hi)
}
}
lo=c()
hi=c()
for (x in 1:nrow(data_with_n)){
lo = c(lo,PI(data_with_n$beta_orig[x],data_with_n$n.O[x],data_with_n$n.R[x]))
hi = c(hi,PI(data_with_n$beta_orig[x],data_with_n$n.O[x],data_with_n$n.R[x],lower=F))
}
data_jeff = data.frame(cbind("Study" =data_with_n[,1],"orig" =data_with_n[,2] ,
"rep"=RPP_filtered[,4] ,"pval"=NA, "PIlow" =lo,"PIhigh" =hi))
data_jeff[,1]<-as.factor(data_jeff[,1])
data_jeff$significance = as.factor(((data_jeff$rep>data_jeff$PIlow) & (data_jeff$rep<data_jeff$PIhigh))+0)
## Distinguishability PI
pval=c()
lo=c()
hi=c()
for (x in 1:nrow(RPP_filtered)){
res = PRP_MCMC_with_PI(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec)
pval = c(pval,res$pval)
lo = c(lo,res$left_bound)
hi = c(hi,res$right_bound)
}
data_D = data.frame(cbind("Study" =RPP_filtered[,1],"orig" =RPP_filtered[,2] ,
"rep"=RPP_filtered[,4] ,"pval"=pval,"PIlow" =lo,"PIhigh" =hi))
data_D$significance = as.factor((data_D$pval>0.05)+0)
### DC PI
rpp_pval<-sapply(1:nrow(RPP_filtered),function(x)
prior_prp(beta=c(beta_orig[x], beta_rep[x]),se=c(se_orig[x],  se_rep[x]))$pvalue)
rpp_PI<-sapply(1:nrow(RPP_filtered),function(x)
prior_prp(beta=c(beta_orig[x], beta_rep[x]),se=c(se_orig[x],  se_rep[x]),report_PI = T)$predictive_interval)
rpp_PI<-t(rpp_PI)
data_dc<-data.frame(cbind("Study"=RPP_filtered[,1],"orig" =RPP_filtered[,2] ,
"rep"=RPP_filtered[,4] ,"pval"=rpp_pval, "PIlow" =rpp_PI[,1],"PIhigh" =rpp_PI[,2]))
data_dc$significance = as.factor((data_dc$pval>0.05)+0)
data_d
data_D
data_dc
data_jeff
####
data_new <-cbind(rbind(data_jeff,data_dc,data_D),rep(c("predictive_interval","DC","Distinguishability"),each=nrow(data_dc)))
View(data_new)
####
data_new <-cbind(rbind(data_jeff,data_dc,data_D),type=rep(c("predictive_interval","DC","Distinguishability"),each=nrow(data_dc)))
View(data_new)
ylim(-0.6,3.5)+
theme_bw()
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study2,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
#scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
#coord_flip()+
facet_grid(cols=type)+
ylim(-0.6,3.5)+
theme_bw()
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study2,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
#scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
#coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
#scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
#coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
#scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
####
data_new <-cbind(rbind(data_jeff,data_dc,data_D),type=rep(c("Patil PI","DC PI","Distinguishability PI"),each=nrow(data_dc)))
pdf(file = paste0("rpp_jeffleek.pdf"),width=6,height=8.5)
dev.off()
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
pval=c()
lo=c()
hi=c()
for (x in 1:nrow(RPP_filtered)){
res = PRP_MCMC_with_PI(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec)
pval = c(pval,res$pval)
lo = c(lo,res$left_bound)
hi = c(hi,res$right_bound)
}
data_D = data.frame(cbind("Study" =RPP_filtered[,1],"orig" =RPP_filtered[,2] ,
"rep"=RPP_filtered[,4] ,"pval"=pval,"PIlow" =lo,"PIhigh" =hi))
data_D$significance = as.factor((data_D$pval>0.05)+0)
data_D[,1]<-as.factor(data_D[,1])
data_D<- data_D[order(data_D$pval,decreasing = T),]
View(data_D)
####
data_new <-cbind(rbind(data_jeff,data_dc,data_D),type=rep(c("Patil PI","DC PI","Distinguishability PI"),each=nrow(data_dc)))
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
data_D$Study
data_new$Study <-factor(data_new$Study, levels=data_D$Study)
View(data_new)
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
data_new$type<-factor(data_new$type, levels=c("Distinguishability PI","Patil PI","DC PI"))
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
data_new <-cbind(rbind(data_jeff,data_dc,data_D),type=rep(c("Patil et al PI","DC PI","Distinguishability PI"),each=nrow(data_dc)))
data_new$Study <-factor(data_new$Study, levels=data_D$Study)
data_new$type<-factor(data_new$type, levels=c("Distinguishability PI","Patil et al PI","DC PI"))
setwd("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/RPP_analyze")
pdf(file = paste0("rpp_overlay.pdf"),width=8.5,height=8.5)
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
dev.off()
pdf(file = paste0("rpp_overlay.pdf"),width=9,height=8.5)
ggplot(data_new)+
geom_pointrange(aes(x=Study, y=orig, ymin=PIlow, ymax=PIhigh),color="darkblue",shape=3,fatten=2)+
geom_hline(yintercept = 0, linetype=2)+
geom_point(aes(x=Study,y=rep,color=significance))+
labs( x = "study ID", y = "estimated effect") +
scale_color_manual(" ",labels = c("Outside PI", "Inside PI"), values = c("red", "blue")) +
coord_flip()+
facet_grid(cols=vars(type))+
ylim(-0.6,3.5)+
theme_bw()
dev.off()
setwd("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/pub_bias")
library(ggplot2)
pubbias001<-read.table("./output/pubbias_2grp_pthresh_0.01.prp.out")
pubbias005<-read.table("./output/pubbias_2grp_pthresh_0.05.prp.out")
pubbiasno<-read.table("./output/pubbias_2grp_pthresh_1.prp.out")
pubbias001p<-read.table("./output/pubbias_2grp_pthresh_0.01_pubbias_ts.prp.out")
pubbias005p<-read.table("./output/pubbias_2grp_pthresh_0.05_pubbias_ts.prp.out")
pubbiasnop<-read.table("./output/pubbias_2grp_pthresh_1_pubbias_ts.prp.out")
data_plot<-data.frame(pval_censor=rep(c("0.01","0.05","no censor"),each=10000),
test_statistics=rep(c("default","pub_bias","default","pub_bias","default","pub_bias"),each=5000),
rep_pval=c(pubbias001$V2,pubbias001p$V2,pubbias005$V2,pubbias005p$V2,pubbiasno$V2,pubbiasnop$V2))
data_plot$pval_censor = factor(data_plot$pval_censor, levels=c('no censor','0.05','0.01'))
data_plot$test_statistics=factor(data_plot$test_statistics,levels=c("default","pub_bias"))
levels(data_plot$pval_censor)=c("'no censoring'", "'censoring at p=0.05'","'censoring at p=0.01'")
levels(data_plot$test_statistics) =c("'default test statistic'",expression(T[pb] == hat(beta)[rep]/hat(beta)[orig]))
p<-ggplot(data=data_plot,aes(x=rep_pval))+
geom_histogram(color="darkblue",fill="white",bins=10,boundary=1)+
scale_x_continuous(limits=c(0,1))+
facet_grid(pval_censor~test_statistics,labeller =label_parsed)+
theme_bw()+xlab(expression(p[prior]~Distinguishability~Criterion))
p
pdf(file="./plots/mcmc_pub_bias.pdf", width=5.5, height=7.5)
ggplot(data=data_plot,aes(x=rep_pval))+
geom_histogram(color="darkblue",fill="white",bins=10,boundary=1)+
scale_x_continuous(limits=c(0,1))+
facet_grid(pval_censor~test_statistics,labeller =label_parsed)+
theme_bw()+xlab(expression(p[prior]~Distinguishability~Criterion))
dev.off()
pdf(file="./plots/mcmc_pub_bias.pdf", width=5.5, height=7)
ggplot(data=data_plot,aes(x=rep_pval))+
geom_histogram(color="darkblue",fill="white",bins=10,boundary=1)+
scale_x_continuous(limits=c(0,1))+
facet_grid(pval_censor~test_statistics,labeller =label_parsed)+
theme_bw()+xlab(expression(p[prior]~Distinguishability~Criterion))
dev.off()
