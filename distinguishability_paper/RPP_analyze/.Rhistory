## posterior distribution for barbeta
posterior_barbeta<-function(barbeta,k,beta_o,sigma_o){
med<-k^2*barbeta^2+sigma_o^2
#nom<-(1/sqrt(2*pi*med))*exp(-(beta_o-barbeta)^2/(2*med))
lognom = -0.5*log(2*pi*med)-(beta_o-barbeta)^2/(2*med)
denom<-integrate(integrate1,-Inf,Inf,rel.tol=1e-15,
k=k,beta_o=beta_o,sigma_o=sigma_o)
#denom<-integral(Vectorize(integrate1),xmin=-Inf,xmax=Inf,k=k,beta_o=beta_o,sigma_o=sigma_o)
res = exp(lognom - log(denom$value))
return(res)
#return(nom/denom)
}
integrate2<-function(x,betar,k,beta_o,sigma_o){
#val<-(1/sqrt(2*pi*k^2*x^2))*posterior_barbeta(x,k,beta_o,sigma_o)*exp(-(betar-x)^2/(2*k^2*x^2))
val = exp(-0.5*log(2*pi*k^2*x^2)
+posterior_barbeta(x,k,beta_o,sigma_o)
-(betar-x)^2/(2*k^2*x^2))
return(val)
}
## posterior distribution for beta_r
posterior_betar<-function(betar,k,beta_o,sigma_o){
val<-integrate(integrate2,-Inf,Inf,rel.tol=1e-15,
subdivisions=1e3,
betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
#val <- integral(Vectorize(integrate2),xmin=-Inf,xmax=Inf,
#           betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
return(val$value)
#return(val)
}
integrate3<-function(x,betahat,k,beta_o,sigma_o,sigma_r){
#val= (1/sqrt(2*pi*sigma_r^2))*posterior_betar(x,k,beta_o,sigma_o)* exp(-(betahat-x)^2/(2*sigma_r^2))
val = exp(-0.5*log(2*pi*sigma_r^2)+
posterior_betar(x,k,beta_o,sigma_o)-
(betahat-x)^2/(2*sigma_r^2))
return(val)
}
## posterior distribution for hatbeta_r
posterior_betahat<-function(betahat,k,beta_o,sigma_o,sigma_r){
val<-integrate(Vectorize(integrate3),-Inf,Inf,
rel.tol=1e-15,
subdivisions=1e3,
betahat=betahat,k=k,beta_o=beta_o,
sigma_o=sigma_o,sigma_r=sigma_r)
return(val$value)
#return(val)
}
##calculation
prp_dc_cefn<-function(beta,se, k_vec,num){
print(num)
beta_o<-beta[1]
sigma_o<-se[1]^2
sigma_r<-se[2]^2
beta_r<-beta[2]
pval_list<-c()
for (k in k_vec){
pval<-integrate(Vectorize(posterior_betahat),
beta_r,Inf,rel.tol=1e-15,
subdivisions=1e3,
k=k,beta_o=beta_o,sigma_o=sigma_o,sigma_r=sigma_r)$value
#pval<-integral(Vectorize(posterior_betahat),xmin=beta_r,xmax=Inf,k=k,beta_o=beta_o,
#          sigma_o=sigma_o,sigma_r=sigma_r)
pval_list <-c(pval_list,pval)
}
res <- mean(pval_list)
return(2*min(res,1-res))
}
rpp_pval_1<-sapply(31, function(x)
prp_dc_cefn(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),
k_vec=root_vec,num=x))
## posterior distribution for barbeta
posterior_barbeta<-function(barbeta,k,beta_o,sigma_o){
med<-k^2*barbeta^2+sigma_o^2
#nom<-(1/sqrt(2*pi*med))*exp(-(beta_o-barbeta)^2/(2*med))
lognom = -0.5*log(2*pi*med)-(beta_o-barbeta)^2/(2*med)
denom<-integrate(integrate1,-Inf,Inf,rel.tol=1e-3,
k=k,beta_o=beta_o,sigma_o=sigma_o)
#denom<-integral(Vectorize(integrate1),xmin=-Inf,xmax=Inf,k=k,beta_o=beta_o,sigma_o=sigma_o)
res = exp(lognom - log(denom$value))
return(res)
#return(nom/denom)
}
rpp_pval_1<-sapply(31, function(x)
prp_dc_cefn(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),
k_vec=root_vec,num=x))
## posterior distribution for beta_r
posterior_betar<-function(betar,k,beta_o,sigma_o){
val<-integrate(integrate2,-Inf,Inf,rel.tol=1e-15,
betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
#val <- integral(Vectorize(integrate2),xmin=-Inf,xmax=Inf,
#           betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
return(val$value)
#return(val)
}
rpp_pval_1<-sapply(31, function(x)
prp_dc_cefn(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),
k_vec=root_vec,num=x))
## posterior distribution for beta_r
posterior_betar<-function(betar,k,beta_o,sigma_o){
val<-integrate(integrate2,-Inf,Inf,rel.tol=1e-3,
betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
#val <- integral(Vectorize(integrate2),xmin=-Inf,xmax=Inf,
#           betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
return(val$value)
#return(val)
}
rpp_pval_1<-sapply(31, function(x)
prp_dc_cefn(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),
k_vec=root_vec,num=x))
## posterior distribution for hatbeta_r
posterior_betahat<-function(betahat,k,beta_o,sigma_o,sigma_r){
val<-integrate(Vectorize(integrate3),-Inf,Inf,
rel.tol=1e-3,
betahat=betahat,k=k,beta_o=beta_o,
sigma_o=sigma_o,sigma_r=sigma_r)
return(val$value)
#return(val)
}
##calculation
prp_dc_cefn<-function(beta,se, k_vec,num){
print(num)
beta_o<-beta[1]
sigma_o<-se[1]^2
sigma_r<-se[2]^2
beta_r<-beta[2]
pval_list<-c()
for (k in k_vec){
pval<-integrate(Vectorize(posterior_betahat),
beta_r,Inf,rel.tol=1e-3,
k=k,beta_o=beta_o,sigma_o=sigma_o,sigma_r=sigma_r)$value
#pval<-integral(Vectorize(posterior_betahat),xmin=beta_r,xmax=Inf,k=k,beta_o=beta_o,
#          sigma_o=sigma_o,sigma_r=sigma_r)
pval_list <-c(pval_list,pval)
}
res <- mean(pval_list)
return(2*min(res,1-res))
}
rpp_pval_1<-sapply(31, function(x)
prp_dc_cefn(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),
k_vec=root_vec,num=x))
integrate1<-function(x,k,beta_o,sigma_o){
vari<-k^2*x^2+sigma_o^2
#value<-(1/sqrt(2*pi*vari))*exp(-(beta_o-x)^2/(2*vari))
value <- exp(-0.5*log(2*pi*vari)-(beta_o-x)^2/(2*vari))
return(value)
}
## posterior distribution for barbeta
posterior_barbeta<-function(barbeta,k,beta_o,sigma_o){
med<-k^2*barbeta^2+sigma_o^2
#nom<-(1/sqrt(2*pi*med))*exp(-(beta_o-barbeta)^2/(2*med))
lognom = -0.5*log(2*pi*med)-(beta_o-barbeta)^2/(2*med)
denom<-integrate(integrate1,-Inf,Inf,rel.tol=1e-3,
k=k,beta_o=beta_o,sigma_o=sigma_o)
#denom<-integral(Vectorize(integrate1),xmin=-Inf,xmax=Inf,k=k,beta_o=beta_o,sigma_o=sigma_o)
res = exp(lognom - log(denom$value))
return(res)
#return(nom/denom)
}
integrate2<-function(x,betar,k,beta_o,sigma_o){
#val<-(1/sqrt(2*pi*k^2*x^2))*posterior_barbeta(x,k,beta_o,sigma_o)*exp(-(betar-x)^2/(2*k^2*x^2))
val = exp(-0.5*log(2*pi*k^2*x^2)
+posterior_barbeta(x,k,beta_o,sigma_o)
-(betar-x)^2/(2*k^2*x^2))
return(val)
}
## posterior distribution for beta_r
posterior_betar<-function(betar,k,beta_o,sigma_o){
val<-integrate(integrate2,-Inf,Inf,rel.tol=1e-3,
stop.on.error = FALSE,
betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
#val <- integral(Vectorize(integrate2),xmin=-Inf,xmax=Inf,
#           betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
return(val$value)
#return(val)
}
integrate3<-function(x,betahat,k,beta_o,sigma_o,sigma_r){
#val= (1/sqrt(2*pi*sigma_r^2))*posterior_betar(x,k,beta_o,sigma_o)* exp(-(betahat-x)^2/(2*sigma_r^2))
val = exp(-0.5*log(2*pi*sigma_r^2)+
posterior_betar(x,k,beta_o,sigma_o)-
(betahat-x)^2/(2*sigma_r^2))
return(val)
}
## posterior distribution for hatbeta_r
posterior_betahat<-function(betahat,k,beta_o,sigma_o,sigma_r){
val<-integrate(Vectorize(integrate3),-Inf,Inf,
rel.tol=1e-3,
betahat=betahat,k=k,beta_o=beta_o,
sigma_o=sigma_o,sigma_r=sigma_r)
return(val$value)
#return(val)
}
##calculation
prp_dc_cefn<-function(beta,se, k_vec,num){
print(num)
beta_o<-beta[1]
sigma_o<-se[1]^2
sigma_r<-se[2]^2
beta_r<-beta[2]
pval_list<-c()
for (k in k_vec){
pval<-integrate(Vectorize(posterior_betahat),
beta_r,Inf,rel.tol=1e-3,
stop.on.error = FALSE,
k=k,beta_o=beta_o,sigma_o=sigma_o,sigma_r=sigma_r)$value
#pval<-integral(Vectorize(posterior_betahat),xmin=beta_r,xmax=Inf,k=k,beta_o=beta_o,
#          sigma_o=sigma_o,sigma_r=sigma_r)
pval_list <-c(pval_list,pval)
}
res <- mean(pval_list)
return(2*min(res,1-res))
}
rpp_pval_1<-sapply(31, function(x)
prp_dc_cefn(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),
k_vec=root_vec,num=x))
## posterior distribution for barbeta
posterior_barbeta<-function(barbeta,k,beta_o,sigma_o){
med<-k^2*barbeta^2+sigma_o^2
#nom<-(1/sqrt(2*pi*med))*exp(-(beta_o-barbeta)^2/(2*med))
lognom = -0.5*log(2*pi*med)-(beta_o-barbeta)^2/(2*med)
denom<-integrate(integrate1,-Inf,Inf,rel.tol=1e-3,stop.on.error = FALSE,
k=k,beta_o=beta_o,sigma_o=sigma_o)
#denom<-integral(Vectorize(integrate1),xmin=-Inf,xmax=Inf,k=k,beta_o=beta_o,sigma_o=sigma_o)
res = exp(lognom - log(denom$value))
return(res)
#return(nom/denom)
}
integrate1<-function(x,k,beta_o,sigma_o){
vari<-k^2*x^2+sigma_o^2
#value<-(1/sqrt(2*pi*vari))*exp(-(beta_o-x)^2/(2*vari))
value <- exp(-0.5*log(2*pi*vari)-(beta_o-x)^2/(2*vari))
return(value)
}
## posterior distribution for barbeta
posterior_barbeta<-function(barbeta,k,beta_o,sigma_o){
med<-k^2*barbeta^2+sigma_o^2
#nom<-(1/sqrt(2*pi*med))*exp(-(beta_o-barbeta)^2/(2*med))
lognom = -0.5*log(2*pi*med)-(beta_o-barbeta)^2/(2*med)
denom<-integrate(integrate1,-Inf,Inf,rel.tol=1e-3,stop.on.error = FALSE,
k=k,beta_o=beta_o,sigma_o=sigma_o)
#denom<-integral(Vectorize(integrate1),xmin=-Inf,xmax=Inf,k=k,beta_o=beta_o,sigma_o=sigma_o)
res = exp(lognom - log(denom$value))
return(res)
#return(nom/denom)
}
integrate2<-function(x,betar,k,beta_o,sigma_o){
#val<-(1/sqrt(2*pi*k^2*x^2))*posterior_barbeta(x,k,beta_o,sigma_o)*exp(-(betar-x)^2/(2*k^2*x^2))
val = exp(-0.5*log(2*pi*k^2*x^2)
+posterior_barbeta(x,k,beta_o,sigma_o)
-(betar-x)^2/(2*k^2*x^2))
return(val)
}
## posterior distribution for beta_r
posterior_betar<-function(betar,k,beta_o,sigma_o){
val<-integrate(integrate2,-Inf,Inf,rel.tol=1e-3,
stop.on.error = FALSE,
betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
#val <- integral(Vectorize(integrate2),xmin=-Inf,xmax=Inf,
#           betar=betar,k=k,beta_o=beta_o,sigma_o=sigma_o)
return(val$value)
#return(val)
}
integrate3<-function(x,betahat,k,beta_o,sigma_o,sigma_r){
#val= (1/sqrt(2*pi*sigma_r^2))*posterior_betar(x,k,beta_o,sigma_o)* exp(-(betahat-x)^2/(2*sigma_r^2))
val = exp(-0.5*log(2*pi*sigma_r^2)+
posterior_betar(x,k,beta_o,sigma_o)-
(betahat-x)^2/(2*sigma_r^2))
return(val)
}
## posterior distribution for hatbeta_r
posterior_betahat<-function(betahat,k,beta_o,sigma_o,sigma_r){
val<-integrate(Vectorize(integrate3),-Inf,Inf,
rel.tol=1e-3,
stop.on.error = FALSE,
betahat=betahat,k=k,beta_o=beta_o,
sigma_o=sigma_o,sigma_r=sigma_r)
return(val$value)
#return(val)
}
##calculation
prp_dc_cefn<-function(beta,se, k_vec,num){
print(num)
beta_o<-beta[1]
sigma_o<-se[1]^2
sigma_r<-se[2]^2
beta_r<-beta[2]
pval_list<-c()
for (k in k_vec){
pval<-integrate(Vectorize(posterior_betahat),
beta_r,Inf,rel.tol=1e-3,
stop.on.error = FALSE,
k=k,beta_o=beta_o,sigma_o=sigma_o,sigma_r=sigma_r)$value
#pval<-integral(Vectorize(posterior_betahat),xmin=beta_r,xmax=Inf,k=k,beta_o=beta_o,
#          sigma_o=sigma_o,sigma_r=sigma_r)
pval_list <-c(pval_list,pval)
}
res <- mean(pval_list)
return(2*min(res,1-res))
}
rpp_pval_1<-sapply(31, function(x)
prp_dc_cefn(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),
k_vec=root_vec,num=x))
beta11=0.310
beta21=0.017
beta12=-0.266
beta22=0.387
se11 = 0.104
cov1=-0.083
se21 = 0.140
se12 = 0.063
cov2=-0.048
se22 = 0.091
W1 =matrix(c(se11,cov1,cov1,se21),nrow=2)
W2 =matrix(c(se12,cov2,cov2,se22),nrow=2)
W1
W1
W1
W2
cov1/sqrt(var11*var21)
cov1/sqrt(se11*se21),
cov1/sqrt(se11*se21)
W = diag(c(W1,W2))
E
W
c(W1)
W = bdiag(c(W1,W2))
install.packages("Matrix")
library("Matrix")
W = bdiag(c(W1,W2))
W
bdiag(diag(3),diag(6))
W = bdiag(W1,W2)
W
W[3,1]
X
Y = c(y1,y2)
X = c(x1,x2)
y1 = c(beta11/sqrt(se11), beta21/sqrt(se21))
y2 = c(beta12/sqrt(se12), beta22/sqrt(se22))
x1 = c(1/sqrt(se11),1/sqrt(se21))
x2 = c(1/sqrt(se12),1/sqrt(se22))
Y = c(y1,y2)
X = c(x1,x2)
Y
X
X%*%W%*%t(X)
t(X)%*%W%*%X
X = cbind(rep(1,4),c(x1,x2))
X
t(X)%*%W%*%X
solve(t(X)%*%W%*%X)
solve(t(X)%*%W%*%X)%*%t(X)%*%W%*%Y
est_var <-solve(t(X)%*%W%*%X)
est_var
W
est_var <-solve(t(X)%*%W%*%X)
est_var
est
est<-solve(t(X)%*%W%*%X)%*%t(X)%*%W%*%Y
est
est_var[1,1]
sqrt(est_var[1,1])
ets[1]^2/est_var[1,1]
est[1]^2/est_var[1,1]
T= (tan((0.5-0.0017)*pi)+tan((0.5-0.8294)*pi)+tan((0.5-0.833)*pi))/3
1/2 - atan(T)/pi
T= (tan((0.5-0.0015)*pi)+tan((0.5-0.999)*pi)+tan((0.5-0.997)*pi))/3
1/2 - atan(T)/pi
T
T= (tan((0.5-0.0017)*pi)+tan((0.5-0.8294)*pi)+tan((0.5-0.833)*pi))/3
T
tan((0.5-0.0015)
)
tan((0.5-0.0015)*pi)
tan((0.5-0.0017)*pi)
tan((0.5-0.082)*pi)
tan((0.5-0.099)*pi)
tan((0.5-0.997)*pi)
tan((0.5-0.83)*pi)
setwd("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/batch_eff/output")
pval<-read.table("batch_2grp_bb_sd_0.prp.out",header=T)
View(pval)
pval<-read.table("batch_2grp_bb_sd_0.prp.out",header=TRUE)
View(pval)
pval<-read.table("batch_2grp_bb_sd_0.prp.out",header=FALSE)
View(pval)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("batch_2grp_bb_sd_0.2.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("batch_2grp_bb_sd_0.4.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("batch_2grp_bb_sd_0.6.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("batch_2grp_bb_sd_0.8.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("batch_2grp_bb_sd_1.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
setwd("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/pub_bias/output")
pval<-read.table("pubbias_2grp_pthresh_1.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("pubbias_2grp_pthresh_1_pubbias_ts.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("pubbias_2grp_pthresh_0.05.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("pubbias_2grp_pthresh_0.01.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("pubbias_2grp_pthresh_0.05_pubbias_ts.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
pval<-read.table("pubbias_2grp_pthresh_0.01_pubbias_ts.prp.out",header=FALSE)
length(which(pval[,2]<0.05))/nrow(pval)
setwd("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/RPP_analyze")
setwd("~/Desktop/rep_new/PRP/MCMC/Rcpp_src/RPP_analyze")
library(Rcpp)
library(RcppArmadillo)
library(RcppGSL)
Rcpp::sourceCpp("PRP_MCMC_pubbias.cpp")
t= seq(0.001,0.05,0.001)
root_vec<-c(0)
for (t_ind in t){
f = function(k){
g = function(x){
(1/(1+exp(0.5*(1/k)^2+x/k)))*dnorm(x)}
return(integrate(g,-Inf,Inf)$value - t_ind)
}
root<-uniroot(f,c(1e-100,1e5),tol = .Machine$double.eps^0.2)$root
root_vec<-c(root_vec,root)
}
library(PRP)
data("RPP_filtered")
attach(RPP_filtered)
rpp_pval_pubbias<-sapply(1:nrow(RPP_filtered),function(x)
PRP_MCMC(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec)$pval)
rpp_pval_pubbias<-sapply(1:nrow(RPP_filtered),function(x)
PRP_MCMC(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec))
#data = cbind(RPP_filtered,"PRP_MCMC" = rpp_pval)
data = cbind(RPP_filtered,"PRP_MCMC" = rpp_pval_pubbias)
#write.table(data,file="res.dat")
write.table(data,file="res_pubbias.dat")
hist(rpp_pval_pubbias)
rpp_pval_ref = sapply(1:nrow(RPP_filtered),function(x)
prior_prp(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),test="pub_bias")$pval)
hist(rpp_pval_ref)
_
rpp_pval_ref = sapply(1:nrow(RPP_filtered),function(x)
prior_prp(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]))$pval)
Rcpp::sourceCpp("PRP_MCMC_with_PI.cpp")
rpp_pval<-sapply(1:nrow(RPP_filtered),function(x)
PRP_MCMC_with_PI(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec)$pval)
rpp_1=data.frame(prior-PRP=rep(c("original","MCMC"),each=nrow(RPP_filtered)),rep_pval=c(rpp_pval_ref,rpp_pval))
rpp_1=data.frame(priorPRP=rep(c("original","MCMC"),each=nrow(RPP_filtered)),rep_pval=c(rpp_pval_ref,rpp_pval))
pdf(file = paste0("output/rpp_pval_default_ts.pdf"),width=6,height=5)
pdf(file = paste0("rpp_pval_default_ts.pdf"),width=6,height=5)
ggplot(rpp_1,aes(x=rep_pval))+
geom_histogram(aes(fill=priorPRP),color="white",bins=10,alpha=0.5,boundary=0,position = 'identity')+
scale_x_continuous(limits = c(0, 1))+
scale_fill_manual("prior-PRP",labels=c("DC","D"),values=c("#69b3a2", "#404080"))+
xlab(expression(p["prior"]))+
theme_bw()
library(ggplot2)
ggplot(rpp_1,aes(x=rep_pval))+
geom_histogram(aes(fill=priorPRP),color="white",bins=10,alpha=0.5,boundary=0,position = 'identity')+
scale_x_continuous(limits = c(0, 1))+
scale_fill_manual("prior-PRP",labels=c("DC","D"),values=c("#69b3a2", "#404080"))+
xlab(expression(p["prior"]))+
theme_bw()
dev.off()
rpp_pval_pubbias_ref<-sapply(1:nrow(RPP_filtered),function(x)
PRP_MCMC(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec))
rpp_pval_pubbias_ref = sapply(1:nrow(RPP_filtered),function(x)
prior_prp(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]),test="pub_bias")$pval)
rpp_pval_pubbias<-sapply(1:nrow(RPP_filtered),function(x)
PRP_MCMC(beta=c(beta_orig[x], beta_rep[x]),
se=c(se_orig[x], se_rep[x]), k_vec=root_vec))
rpp_1=data.frame(priorPRP=rep(c("original","MCMC"),each=nrow(RPP_filtered)),rep_pval=c(rpp_pval_pubbias_ref,rpp_pval_ref))
pdf(file = paste0("rpp_pval_pubbias_ts.pdf"),width=6,height=5)
ggplot(rpp_1,aes(x=rep_pval))+
geom_histogram(aes(fill=priorPRP),color="white",bins=10,alpha=0.5,boundary=0,position = 'identity')+
scale_x_continuous(limits = c(0, 1))+
scale_fill_manual("prior-PRP",labels=c("DC","D"),values=c("#69b3a2", "#404080"))+
xlab(expression(p["prior"]))+
theme_bw()
dev.off()
pdf(file = paste0("rpp_pval_pubbias_ts.pdf"),width=6,height=5)
ggplot(rpp_1,aes(x=rep_pval))+
geom_histogram(aes(fill=priorPRP),color="white",bins=10,alpha=0.5,boundary=0,position = 'identity')+
scale_x_continuous(limits = c(0, 1))+
scale_fill_manual("prior-PRP",labels=c("DC criterion","D criterion"),values=c("#69b3a2", "#404080"))+
xlab(expression(p["prior"]))+
theme_bw()
dev.off()
rpp_1=data.frame(priorPRP=rep(c("original","MCMC"),each=nrow(RPP_filtered)),rep_pval=c(rpp_pval_ref,rpp_pval))
pdf(file = paste0("rpp_pval_default_ts.pdf"),width=6,height=5)
ggplot(rpp_1,aes(x=rep_pval))+
geom_histogram(aes(fill=priorPRP),color="white",bins=10,alpha=0.5,boundary=0,position = 'identity')+
scale_x_continuous(limits = c(0, 1))+
scale_fill_manual("prior-PRP",labels=c("DC criterion","D criterion"),values=c("#69b3a2", "#404080"))+
xlab(expression(p["prior"]))+
theme_bw()
dev.off()
length(which(rpp_pval_pubbias<0.05))
